<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Seguran√ßa ‚Ä¢ G M√ÅQUINA</title>
  <link rel="stylesheet" href="css/theme.css"/>

  <style>
    .span-12{grid-column:span 12}
    .span-8{grid-column:span 8}
    .span-6{grid-column:span 6}
    .span-4{grid-column:span 4}

    .titleRow{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .titleRow h3{margin:0}

    .sensorGrid{display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; margin-top:12px}
    .sensor{
      grid-column: span 6;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    .sensor:before{
      content:"";
      position:absolute; inset:-90px;
      background: radial-gradient(420px 200px at 85% 35%, rgba(230,184,76,.10), transparent 60%);
      pointer-events:none;
    }
    .sensor > *{position:relative}
    .sHead{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .sVal{font-size:20px; font-weight:950; margin-top:8px}
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      font-size:12px;
    }
    .state{
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      font-size:12px;
    }
    .state.ok{border-color: rgba(46,229,157,.45); background: rgba(46,229,157,.10)}
    .state.warn{border-color: rgba(230,184,76,.55); background: rgba(230,184,76,.12)}
    .state.bad{border-color: rgba(255,77,77,.55); background: rgba(255,77,77,.12)}

    .log{
      margin-top:12px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      overflow:hidden;
    }
    .logItem{
      padding:10px 12px;
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      border-top:1px solid rgba(255,255,255,.08);
      font-size:13px;
    }
    .logItem:first-child{border-top:none}
    .time{color:var(--muted)}

    .switch{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      margin-top:12px;
    }
    .toggle{
      width:54px; height:30px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      position:relative; cursor:pointer;
      transition:.18s ease;
    }
    .toggle i{
      position:absolute; top:50%; transform:translateY(-50%);
      left:4px; width:22px; height:22px; border-radius:999px;
      background: rgba(255,255,255,.85);
      transition:.18s ease;
    }
    .toggle.on{
      border-color: rgba(85,214,190,.55);
      background: rgba(85,214,190,.14);
    }
    .toggle.on i{left:28px; background: rgba(46,229,157,.95)}
    @media (max-width: 980px){
      .span-8,.span-6,.span-4{grid-column:span 12}
      .sensor{grid-column:span 12}
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img src="assets/logo-gmaquina.png" alt="G M√ÅQUINA">
        <div>
          <div class="t1">G M√ÅQUINA ‚Ä¢ Seguran√ßa</div>
          <div class="t2">Per√≠metro ‚Ä¢ sensores ‚Ä¢ alarmes</div>
        </div>
      </div>

      <div class="nav">
        <a href="index.html">Central</a>
        <a href="irrigacao.html">Irriga√ß√£o</a>
        <a class="active" href="seguranca.html">Seguran√ßa</a>
        <a href="iluminacao.html">Ilumina√ß√£o</a>
      </div>
    </div>
  </div>

  <div class="container">

    <section class="hero">
      <h1 class="h-title">Seguran√ßa & Per√≠metro</h1>
      <p class="h-sub">
        Controle do modo de seguran√ßa, sensores e respostas autom√°ticas.
        Hoje em simula√ß√£o ‚Äî depois ligamos no ESP32 de seguran√ßa.
      </p>
      <div class="badges">
        <div class="badge"><span class="dot warn"></span><span>Modo: Simula√ß√£o</span></div>
        <div class="badge"><span class="dot"></span><span>M√≥dulo: Online</span></div>
        <div class="badge"><span class="dot"></span><span>Log de eventos ativo</span></div>
      </div>
    </section>

    <section class="grid">

      <!-- STATUS / CONTROLE -->
      <div class="card span-8">
        <div class="titleRow">
          <h3>üõ°Ô∏è Status do Sistema</h3>
          <span class="pill" id="pill">DESARMADO</span>
        </div>

        <div class="kpis">
          <div class="kpi">Modo: <b id="mode">DESARMADO</b></div>
          <div class="kpi">Sirene: <b id="sirene">OFF</b></div>
          <div class="kpi">√öltimo evento: <b id="lastEvt">‚Äî</b></div>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn primary" id="arm">Armar</button>
          <button class="btn danger" id="disarm">Desarmar</button>
          <button class="btn" id="panic">P√¢nico (sirene)</button>
          <button class="btn ghost" id="silence">Silenciar</button>
        </div>

        <div class="switch">
          <div>
            <div style="font-weight:900">Modo Noturno</div>
            <div class="small">Aumenta sensibilidade e habilita a√ß√µes autom√°ticas (simulado)</div>
          </div>
          <div class="toggle" id="night"><i></i></div>
        </div>
      </div>

      <!-- A√á√ïES AUTOM√ÅTICAS -->
      <div class="card span-4">
        <div class="titleRow">
          <h3>‚öôÔ∏è Automa√ß√£o</h3>
          <span class="pill">Regras</span>
        </div>
        <p class="small" style="margin-top:8px">
          Exemplo: se ‚Äúpresen√ßa‚Äù + sistema armado ‚Üí sirene + notifica√ß√£o (no futuro).
        </p>

        <div style="margin-top:12px; display:grid; gap:10px">
          <div class="chip">‚úÖ Armado + Presen√ßa ‚Üí Sirene</div>
          <div class="chip">‚úÖ Porta aberta ‚Üí Evento no Log</div>
          <div class="chip">‚úÖ Feixe/cerca ‚Üí Alerta</div>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="simEvent">Simular invas√£o</button>
        </div>
      </div>

      <!-- SENSORES -->
      <div class="card span-12">
        <div class="titleRow">
          <h3>üìü Sensores</h3>
          <span class="pill">Tempo real (simulado)</span>
        </div>

        <div class="sensorGrid">
          <div class="sensor">
            <div class="sHead">
              <div class="chip">üö™ Porta / Port√£o</div>
              <span class="state ok" id="stDoor">Fechado</span>
            </div>
            <div class="sVal" id="vDoor">Sem altera√ß√£o</div>
            <div class="small" style="margin-top:10px">Quando abrir, registra no log e pode acionar regra.</div>
          </div>

          <div class="sensor">
            <div class="sHead">
              <div class="chip">üë£ Presen√ßa (PIR)</div>
              <span class="state ok" id="stPir">Normal</span>
            </div>
            <div class="sVal" id="vPir">Nenhuma presen√ßa</div>
            <div class="small" style="margin-top:10px">Se armado, pode disparar sirene.</div>
          </div>

          <div class="sensor">
            <div class="sHead">
              <div class="chip">üì° Feixe / Cerca</div>
              <span class="state ok" id="stFence">OK</span>
            </div>
            <div class="sVal" id="vFence">Sem viola√ß√£o</div>
            <div class="small" style="margin-top:10px">Ideal para per√≠metro e entrada.</div>
          </div>

          <div class="sensor">
            <div class="sHead">
              <div class="chip">üîã Energia / Bateria</div>
              <span class="state warn" id="stPwr">Monitor</span>
            </div>
            <div class="sVal" id="vPwr">Rede normal</div>
            <div class="small" style="margin-top:10px">No futuro: alerta se cair energia.</div>
          </div>
        </div>
      </div>

      <!-- LOG -->
      <div class="card span-12">
        <div class="titleRow">
          <h3>üßæ Log de Eventos</h3>
          <span class="pill">Registrando</span>
        </div>

        <div class="log" id="log"></div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="clear">Limpar log</button>
          <a class="btn ghost" href="index.html">‚¨Ö Voltar</a>
        </div>
      </div>

    </section>

    <div class="small" style="margin-top:18px; opacity:.85">
      Pr√≥ximo bloco: Ilumina√ß√£o ‚Äútop‚Äù com setores, cenas e automa√ß√£o.
    </div>

  </div>

<script>
  const st = {
    armed:false,
    siren:false,
    night:false,
    doorClosed:true,
    pir:false,
    fenceOk:true,
    powerOk:true,
    last:"‚Äî"
  };

  const pill = document.getElementById("pill");
  const mode = document.getElementById("mode");
  const sir  = document.getElementById("sirene");
  const last = document.getElementById("lastEvt");

  const stDoor = document.getElementById("stDoor");
  const vDoor  = document.getElementById("vDoor");

  const stPir = document.getElementById("stPir");
  const vPir  = document.getElementById("vPir");

  const stFence = document.getElementById("stFence");
  const vFence  = document.getElementById("vFence");

  const stPwr = document.getElementById("stPwr");
  const vPwr  = document.getElementById("vPwr");

  const logEl = document.getElementById("log");
  const nightToggle = document.getElementById("night");

  function nowStr(){
    const d = new Date();
    return d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit", second:"2-digit"});
  }
  function pushLog(msg){
    st.last = msg.replace(/<[^>]*>/g,"");
    last.textContent = st.last;
    const item = document.createElement("div");
    item.className = "logItem";
    item.innerHTML = `<div>${msg}</div><div class="time">${nowStr()}</div>`;
    logEl.prepend(item);
    if(logEl.children.length>40) logEl.removeChild(logEl.lastChild);
  }

  function setStateBadge(el, kind, text){
    el.className = "state " + kind;
    el.textContent = text;
  }

  function render(){
    pill.textContent = st.armed ? "ARMADO" : "DESARMADO";
    pill.style.borderColor = st.armed ? "rgba(46,229,157,.45)" : "rgba(255,255,255,.14)";
    pill.style.background  = st.armed ? "rgba(46,229,157,.10)" : "rgba(0,0,0,.22)";
    mode.textContent = st.armed ? "ARMADO" : "DESARMADO";
    sir.textContent  = st.siren ? "ON" : "OFF";

    nightToggle.classList.toggle("on", st.night);

    // Door
    setStateBadge(stDoor, st.doorClosed ? "ok" : (st.armed ? "bad" : "warn"), st.doorClosed ? "Fechado" : "Aberto");
    vDoor.textContent = st.doorClosed ? "Sem altera√ß√£o" : "Porta/port√£o aberto";

    // PIR
    setStateBadge(stPir, st.pir ? (st.armed ? "bad" : "warn") : "ok", st.pir ? "Movimento" : "Normal");
    vPir.textContent = st.pir ? "Presen√ßa detectada" : "Nenhuma presen√ßa";

    // Fence
    setStateBadge(stFence, st.fenceOk ? "ok" : (st.armed ? "bad" : "warn"), st.fenceOk ? "OK" : "Violado");
    vFence.textContent = st.fenceOk ? "Sem viola√ß√£o" : "Per√≠metro violado";

    // Power
    setStateBadge(stPwr, st.powerOk ? "warn" : "bad", st.powerOk ? "Monitor" : "Falha");
    vPwr.textContent = st.powerOk ? "Rede normal" : "Energia caiu";
  }

  function arm(){
    st.armed = true;
    pushLog("‚úÖ Sistema <b>ARMADO</b>.");
    render();
  }
  function disarm(){
    st.armed = false;
    st.siren = false;
    pushLog("üîì Sistema <b>DESARMADO</b>.");
    render();
  }
  function panic(){
    st.siren = true;
    pushLog("üö® <b>P√ÇNICO</b>: sirene ativada.");
    render();
  }
  function silence(){
    st.siren = false;
    pushLog("üîï Sirene silenciada.");
    render();
  }

  document.getElementById("arm").onclick = arm;
  document.getElementById("disarm").onclick = disarm;
  document.getElementById("panic").onclick = panic;
  document.getElementById("silence").onclick = silence;

  nightToggle.onclick = ()=>{
    st.night = !st.night;
    pushLog(st.night ? "üåô Modo noturno <b>ATIVADO</b>." : "‚òÄÔ∏è Modo noturno <b>DESATIVADO</b>.");
    render();
  };

  document.getElementById("simEvent").onclick = ()=>{
    // Simula um evento de invas√£o
    st.pir = true;
    st.fenceOk = false;
    st.doorClosed = Math.random() > 0.5 ? false : st.doorClosed;
    pushLog("‚ö†Ô∏è Evento: <b>atividade suspeita</b> no per√≠metro.");
    if(st.armed){
      st.siren = true;
      pushLog("üö® Regra: sistema armado ‚Üí <b>sirene ON</b>.");
    }
    render();
    setTimeout(()=>{
      st.pir = false;
      st.fenceOk = true;
      st.doorClosed = true;
      render();
      pushLog("‚úÖ Per√≠metro normalizado (simula√ß√£o).");
    }, 2500);
  };

  document.getElementById("clear").onclick = ()=>{
    logEl.innerHTML = "";
    pushLog("Log limpo.");
  };

  // Simula√ß√µes leves autom√°ticas
  setInterval(()=>{
    // chance pequena de evento de porta
    if(Math.random() < 0.18){
      st.doorClosed = !st.doorClosed;
      pushLog(st.doorClosed ? "üö™ Porta fechou." : "üö™ Porta abriu.");
      if(!st.doorClosed && st.armed){
        st.siren = st.night ? true : st.siren;
        pushLog("‚ö†Ô∏è Armado: porta aberta registrada.");
        if(st.night){
          pushLog("üö® Modo noturno: sirene ativada.");
        }
      }
      render();
    }
  }, 6000);

  // init
  pushLog("Painel de seguran√ßa iniciado (simula√ß√£o).");
  render();
</script>
</body>
</html>
